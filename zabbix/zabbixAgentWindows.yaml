  - name: "Zabbix Agent Windows"
    block:
      - name: Instalacja Czekolady
        win_chocolatey:
          name: chocolatey
          state: present

      - name: Instalacja Zabbixa
        win_chocolatey:
          name: zabbix-agent.install
          version: '6.0.6'
          state: present

      - name: Pobranie konfiguracji
        win_template:
          src: zabbix_win.j2
          dest: C:\Program Files\Zabbix Agent\zabbix_agentd.conf

      - name: Otwieranie port√≥w zabbix
        win_firewall_rule:
          name: zabbix agent listen port
          localport: 10051
          action: allow
          direction: in
          protocol: tcp
          state: present
          enabled: yes
      
      - name: ICMP
        win_firewall_rule: 
          name: Port ICMP
          protocol: ICMPv4
          program: Any
          action: allow
          enabled: yes
